<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GroupsApp</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600&family=Syne:wght@700;800&display=swap" rel="stylesheet">
  <!-- CSS -->
  <link rel="stylesheet" href="/css/auth.css">
  <link rel="stylesheet" href="/css/app.css">
</head>
<body>

  <!-- ==================== PANTALLA AUTH ==================== -->
  <div id="screen-auth" class="screen active">
    <div class="auth-card">
      <div class="auth-logo">
        <div class="logo-icon">ğŸ’¬</div>
        <h1>GroupsApp</h1>
        <p>MensajerÃ­a para equipos</p>
      </div>
      <div class="auth-tabs">
        <button class="auth-tab active" onclick="switchTab('login')">Iniciar sesiÃ³n</button>
        <button class="auth-tab" onclick="switchTab('register')">Registrarse</button>
      </div>
      <div id="auth-error" class="auth-error"></div>

      <!-- Login -->
      <div id="form-login">
        <div class="form-group">
          <label>Correo electrÃ³nico</label>
          <input type="email" id="login-email" placeholder="tu@email.com">
        </div>
        <div class="form-group">
          <label>ContraseÃ±a</label>
          <input type="password" id="login-pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                 onkeydown="if(event.key==='Enter') doLogin()">
        </div>
        <button class="btn-primary" onclick="doLogin()">Entrar</button>
      </div>

      <!-- Register -->
      <div id="form-register" style="display:none">
        <div class="form-group">
          <label>Nombre completo</label>
          <input type="text" id="reg-name" placeholder="Tu nombre">
        </div>
        <div class="form-group">
          <label>Correo electrÃ³nico</label>
          <input type="email" id="reg-email" placeholder="tu@email.com">
        </div>
        <div class="form-group">
          <label>ContraseÃ±a</label>
          <input type="password" id="reg-pass" placeholder="MÃ­nimo 6 caracteres"
                 onkeydown="if(event.key==='Enter') doRegister()">
        </div>
        <button class="btn-primary" onclick="doRegister()">Crear cuenta</button>
      </div>
    </div>
  </div>

  <!-- ==================== PANTALLA APP ==================== -->
  <div id="screen-app" class="screen">

    <!-- SIDEBAR -->
    <div class="sidebar">
      <div class="sidebar-header">
        <span class="logo-sm">GroupsApp</span>
        <div class="invite-badge-wrap">
          <button class="icon-btn" title="Invitaciones" onclick="showInvitationsPanel()">ğŸ””</button>
          <span id="invite-badge" class="badge badge-red"></span>
        </div>
        <button class="icon-btn" title="Nuevo grupo" onclick="openModal('modal-create-group')">âœï¸</button>
        <button class="icon-btn" title="Cerrar sesiÃ³n" onclick="logout()">ğŸšª</button>
      </div>

      <div class="sidebar-search">
        <div class="search-wrap">
          <input class="search-input" type="text" placeholder="Buscar grupos..."
                 oninput="filterGroups(this.value)">
        </div>
      </div>

      <div class="sidebar-nav">
        <button class="nav-tab active" onclick="switchSidePanel('groups', this)">Grupos</button>
        <button class="nav-tab" onclick="switchSidePanel('invitations', this)">Invitaciones</button>
      </div>

      <div class="sidebar-list" id="panel-groups">
        <div id="groups-list"></div>
      </div>

      <div class="sidebar-list" id="panel-invitations" style="display:none">
        <div id="invitations-sidebar-list"></div>
      </div>

      <div class="sidebar-user">
        <div style="position:relative">
          <div class="avatar avatar-sm av-blue" id="user-avatar-sm"></div>
          <div class="online-dot"></div>
        </div>
        <div class="user-info">
          <div class="user-name" id="user-name-sidebar"></div>
          <div class="user-email" id="user-email-sidebar"></div>
        </div>
      </div>
    </div>

    <!-- PANEL PRINCIPAL -->
    <div class="main-panel">

      <!-- Welcome -->
      <div class="welcome-state" id="welcome-state">
        <div class="w-icon">ğŸ’¬</div>
        <h2>Bienvenido a GroupsApp</h2>
        <p>Selecciona un grupo o crea uno nuevo</p>
      </div>

      <!-- Vista de grupo -->
      <div class="group-view" id="group-view">
        <div class="group-header">
          <div class="avatar av-blue" id="gv-avatar"></div>
          <div>
            <div class="group-title" id="gv-name"></div>
            <div class="group-meta" id="gv-meta"></div>
          </div>
          <div class="group-header-actions">
            <button class="icon-btn" title="Invitar usuario" onclick="openInviteModal()">â•</button>
            <button class="icon-btn" title="Salir del grupo" onclick="leaveCurrentGroup()">ğŸšª</button>
          </div>
        </div>

        <div class="group-tabs">
          <button class="group-tab active" onclick="switchGroupTab('members', this)">ğŸ‘¥ Miembros</button>
          <button class="group-tab" onclick="switchGroupTab('channels', this)">ğŸ“¢ Canales</button>
        </div>

        <div class="group-content" id="group-content"></div>
      </div>
    </div>
  </div>

  <!-- ==================== MODALES ==================== -->

  <!-- Crear grupo -->
  <div class="modal-overlay" id="modal-create-group">
    <div class="modal">
      <h2>âœ¨ Crear nuevo grupo</h2>
      <div class="form-group">
        <label>Nombre del grupo</label>
        <input type="text" id="new-group-name" placeholder="Ej: Proyecto Distribuido">
      </div>
      <div class="form-group">
        <label>DescripciÃ³n (opcional)</label>
        <textarea class="form-input" id="new-group-desc" placeholder="Â¿De quÃ© trata el grupo?"></textarea>
      </div>
      <div class="form-check">
        <input type="checkbox" id="new-group-private" checked>
        <label for="new-group-private">Grupo privado (solo por invitaciÃ³n)</label>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modal-create-group')">Cancelar</button>
        <button class="btn-modal-primary" onclick="createGroup()">Crear grupo</button>
      </div>
    </div>
  </div>

  <!-- Invitar usuario -->
  <div class="modal-overlay" id="modal-invite">
    <div class="modal">
      <h2>â• Invitar al grupo</h2>
      <div class="form-group">
        <label>Email del usuario</label>
        <input type="email" id="invite-email" placeholder="usuario@email.com">
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modal-invite')">Cancelar</button>
        <button class="btn-modal-primary" onclick="sendInvitation()">Enviar invitaciÃ³n</button>
      </div>
    </div>
  </div>

  <!-- Crear canal -->
  <div class="modal-overlay" id="modal-create-channel">
    <div class="modal">
      <h2>ğŸ“¢ Nuevo canal</h2>
      <div class="form-group">
        <label>Nombre del canal</label>
        <input type="text" id="new-channel-name" placeholder="Ej: general">
      </div>
      <div class="form-group">
        <label>DescripciÃ³n (opcional)</label>
        <input type="text" id="new-channel-desc" placeholder="Â¿Para quÃ© es este canal?">
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal('modal-create-channel')">Cancelar</button>
        <button class="btn-modal-primary" onclick="createChannel()">Crear canal</button>
      </div>
    </div>
  </div>

  <!-- Toasts -->
  <div class="toast-container" id="toast-container"></div>

  <!-- JS â€” orden importante: api primero, luego mÃ³dulos, luego app -->
  <script src="/js/api.js"></script>
  <script src="/js/auth.js"></script>
  <script src="/js/groups.js"></script>
  <script src="/js/invitations.js"></script>
  <script src="/js/app.js"></script>
</body>
</html>